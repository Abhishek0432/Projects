{% csrf_token %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>EASY PG FINDER</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="/static/web/assets/img/favicon.png" rel="icon">
  <link href="/static/web/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Muli:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="/static/web/assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="/static/web/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="/static/web/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/static/web/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/static/web/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="/static/web/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="/static/web/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="/static/web/assets/css/style.css" rel="stylesheet">

  <style>
    /* Additional custom styling can be added here */
    .review {
      
      padding: 20px;
      /* margin-bottom: 20px; */
      border-radius: 5px;
      display: flex;
      align-items: center;
    }
    .review img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-right: 15px;
    }

    .main-div {
      border: 1px solid #ddd;
    }
  </style>
</head>

<body>

  <!-- ======= Top Bar ======= -->
  <section id="topbar" class="d-flex align-items-center">
    <div class="container d-flex justify-content-center justify-content-md-between">
      <div class="contact-info d-flex align-items-center">
        <i class="bi bi-envelope d-flex align-items-center"><a href="mailto:contact@example.com">contact@example.com</a></i>
        <i class="bi bi-phone d-flex align-items-center ms-4"><span>1234567890</span></i>
      </div>
      <div class="social-links d-none d-md-flex align-items-center">
        <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
        <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
        <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
        <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></i></a>
      </div>
    </div>
  </section>

  <!-- ======= Header ======= -->
  <header id="header" class="d-flex align-items-center">
    <div class="container d-flex justify-content-between">

      <div class="logo">
        <h1 class="text-light"><a href="/index/">EASY PG FINDER</a></h1>
      </div>

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="active" href="/index/">Home</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="/pg/">PG</a></li>
          <li><a href="/my_bookings/">My Booking</a></li>
          <li><a href="/contact/">Contact</a></li>
          <li><a href="/login/">Login</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section id="breadcrumbs" class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>PG Details</h2>
          <ol>
            <li><a href="/index/">Home</a></li>
            <li>PG Details</li>
          </ol>
        </div>

      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= Portfolio Details Section ======= -->
    <section id="portfolio-details" class="portfolio-details">
      <div class="container">

        <div class="row gy-4">

          <div class="col-lg-7">
            <div class="portfolio-details">
              <div class="swiper-wrapper align-items-center">
                <div class="swiper-slide">
                  <img src="/static/web/assets/img/pg1.jpg" alt="" id="big_img" width="100%">
                </div>
              </div>
              <div class="swiper-pagination"></div>
            </div>
          </div>

          <input type="hidden" id="txtID" value="{{request.GET.id}}" />

          <div class="col-lg-5">
            <div class="portfolio-info">
              <h3>PG information</h3>
              <ul>
                <li><strong>PG Name</strong>: <span id="name">OUR PG</span> </li>
                <li><strong>PG Price</strong>: <span id="price">900 â‚¹</span> </li>
                <li><strong>PG Address</strong>: <span id="address">RPD Belgaum</span> </li>          
              </ul>

              <h2>PG Details</h2>
              <p id="description">
                
              </p>

              <div class="form-group mb-4">
                <input type="text" class="form-control" placeholder="Your Name" id="txtNameBook" onkeypress="return alphaOnly(event);"/>
              </div>

              <div class="form-group mb-4">
                <input type="text" class="form-control" placeholder="Your Email" id="txtEmailBook"/>
              </div>

              <div class="form-group mb-4">
                <input type="text" class="form-control" placeholder="Your Contact" maxlength="10" id="txtNumberBook" onkeypress="return isNumberKey(event);"/>
              </div>
              <input type="hidden" id="pgID">
              <input type="hidden" id="email">

              <button type="button" class="btn btn-danger btn-round px-5" id="btn_book" onclick="payment();">
                Book Now
              </button>
            </div>
            <div class="portfolio-description">
              
            </div>
          </div>
        </div>
      </div>
    </section><!-- End Portfolio Details Section -->

    <section id="contact" class="contact">
      <div class="container">
        <div class="row mt-5 justify-content-center" data-aos="fade-up">
          <div class="col-lg-10">
            <div class="php-email-form">
              <div class="row" style="margin: auto; justify-content: center;">
                <div style="margin: auto; justify-content: center; display: flex;">
                  <h3>ADD REVIEWS</h3>
                </div>

                <div class="col-md-7 form-group mt-3 mt-md-0">
                  <input type="text" class="form-control" id="txtName1" placeholder="Name">
                </div>
                
                <div class="col-md-7 form-group mt-3 mt-md-0">
                  <input type="email" class="form-control" id="txtEmail1" placeholder="Email">
                </div>

                <div class="col-md-7 form-group mt-3 mt-md-0">
                  <input type="text" class="form-control" id="txtMobileNo1" placeholder="Mobile">
                </div>

                <div class="col-md-7 form-group mt-3 mt-md-0">
                  <input type="text" class="form-control" id="txtReview1" placeholder="Review">
                </div>
                
              </div>
              <div class="my-3">
                
              </div>
              <div class="text-center"><button type="submit" id="btn_submit">Review</button></div>
            </div>
          </div>

        </div>

      </div>
    </section>

    <div class="container py-5">
      <h2 class="text-center mb-4">User Reviews</h2>
      <div class="row" id="userReviews">
        
      </div>
    </div>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">

    <div class="footer-top">
      <div class="container">
        <div class="row">

          <div class="col-lg-4 col-md-6 footer-contact">
            <h3>EASY PG FINDER</h3>
            <p>
              RPD CROSS <br>
              BELAGAVI<br>
              INDIA <br><br>
              <strong>Phone:</strong> +91 9988776655<br>
              <strong>Email:</strong> pgfinder@gmail.com<br>
            </p>
          </div>

          <div class="col-lg-4 col-md-6 footer-links">
            <h4>Useful Links</h4>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Home</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">About us</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Services</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Terms of service</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Privacy policy</a></li>
            </ul>
          </div>

          <div class="col-lg-4 col-md-6 footer-links">
            <h4>Our Services</h4>
            <ul>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Cleaning</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Hot Water</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Food</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Bed</a></li>
              <li><i class="bx bx-chevron-right"></i> <a href="#">Wi-Fi</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="container d-md-flex py-4">

      <div class="me-md-auto text-center text-md-start">
        <div class="copyright">
          &copy; Copyright <strong></strong>. All Rights Reserved
        </div>
      </div>
      <div class="social-links text-center text-md-right pt-3 pt-md-0">
        <a href="#" class="twitter"><i class="bx bxl-twitter"></i></a>
        <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
        <a href="#" class="instagram"><i class="bx bxl-instagram"></i></a>
        <a href="#" class="google-plus"><i class="bx bxl-skype"></i></a>
        <a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
      </div>
    </div>
  </footer><!-- End Footer -->


  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="/static/web/assets/vendor/aos/aos.js"></script>
  <script src="/static/web/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/static/web/assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="/static/web/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="/static/web/assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="/static/web/assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="/static/web/assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="/static/web/assets/js/main.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

</body>

</html>

<script type="text/javascript">

function alphaOnly(event) {
      let key = event.which ? event.which : event.keyCode;
      return (
        (key >= 65 && key <= 90) ||
        key == 8 ||
        (event.charCode >= 97 && event.charCode <= 122) ||
        event.charCode == 32
      );
    }

    function validateEmail(paramEmailID) {
      let filter = /^[0-9a-z.]+\@[a-z0-9]+\.[a-zA-z0-9]{2,4}$/;

      if (filter.test(paramEmailID)) {
        return true;
      } else {
        return false;
      }
    }

    function isNumberKey(evt) {
      let charCode = evt.which ? evt.which : event.keyCode;
      if (charCode > 31 && (charCode < 48 || charCode > 57)) {
        return false;
      }
      return true;
    }
  getData();
  function getData() {
    let formData = new FormData();

    formData.append(
      "csrfmiddlewaretoken",
      $("input[name=csrfmiddlewaretoken]").val()
    );
    formData.append("txtID", $("#txtID").val());
    $.ajax({
      url: "/get_single_item/",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function (response) {
        for (let i = 0; i < response.length; i++) {
          let imgSub = response[i].ab_image.substring(3);

          $("#name").text(response[0].ab_name);
          $("#price").text(response[0].ab_price);
          $("#description").text(response[0].ab_details);
          $("#address").text(response[0].ab_address);
          $("#txtTotalAmt").text("â‚¹" + response[0].pr_price);
          $("#big_img").attr("src", imgSub);

          $("#pgID").val(response[0].ab_id);
          $("#email").val(response[0].ab_created_by);
        }
      },
    });
  }

  function payment() {
    if ($("#txtNameBook").val().trim().length < 1) {
      alert("Please Enter Full Name");
      $("#txtNameBook").focus();
      return false;
    }

    if ($("#txtEmailBook").val().trim().length < 1) {
      alert("Please Enter Email");
      $("#txtEmailBook").focus();
      return false;
    }

    if (!validateEmail($("#txtEmailBook").val())) {
      alert("Please Enter Valid Email");
      $("#txtEmailBook").focus();
      return false;
    }

    if ($("#txtNumberBook").val().trim().length < 10) {
      alert("Please Enter Mobile number");
      $("#txtNumberBook").focus();
      return false;
    }

    let totalAmount = $("#price").text();
    let options = {
      key: "rzp_test_aKbqVbQ3Ciq9KZ",
      amount: totalAmount * 100, // 2000 paise = INR 20
      name: "PG FINDER",
      description: "Payment",
      handler: function (response) {
        booking(response.razorpay_payment_id);
      },
      prefill: {
        contact: $("#txtNumberBook").val(),
        email: $("#txtEmailBook").val(),
      },

      theme: {
        color: "#4caf50",
      },
    };
    let rzp1 = new Razorpay(options);
    rzp1.open();
  }

  function booking(trasID) {
    let formData = new FormData();
    formData.append(
      "csrfmiddlewaretoken",
      $("input[name=csrfmiddlewaretoken]").val()
    );
    formData.append("txtNameBook", $("#txtNameBook").val());
    formData.append("txtEmailBook", $("#txtEmailBook").val());
    formData.append("txtNumberBook", $("#txtNumberBook").val());
    formData.append("pgID", $("#pgID").val());
    formData.append("email", $("#email").val());
    formData.append("totalAmt", $("#price").text());
    formData.append("transaction_id", trasID);

    $.ajax({
      beforeSend: function () {
        $("#btn_submit").attr("disabled", true);
      },
      url: "/web_booking/",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function (result) {
        alert("Payment Successful, Thank You");
        window.location.href = '/my_bookings';
      },
      error: function (request, error) {
        console.error(error);
      },
      complete: function () {
        $("#btn_submit").attr("disabled", false);
      },
    });
  }

  function getProfile() {
    let formData = new FormData();
    formData.append(
      "csrfmiddlewaretoken",
      $("input[name=csrfmiddlewaretoken]").val()
    );
    formData.append("action", "getData");

    $.ajax({
      url: "/user_profile_details/",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function (response) {
        $("#txtNameBook").val(response[0].rg_name);
        $("#txtEmailBook").val(response[0].rg_email);
        $("#txtNumberBook").val(response[0].rg_mobile);
      },
      error: function (request, error) {
        console.error(error);
      },
      complete: function () {},
    });
  }
  getProfile();

  function getReview() {
    let formData = new FormData();
    formData.append(
      "csrfmiddlewaretoken",
      $("input[name=csrfmiddlewaretoken]").val()
    );
    formData.append("pgID", $("#pgID").val());

    $.ajax({
      url: "/get_reviews/",
      type: "POST",
      data: formData,
      processData: false,
      contentType: false,
      success: function (response) {
        for (let i = 0; i < response.length; i++) {
          $("#userReviews").append('<div class="col-md-12 mb-4 main-div"><div class="review"><img src="/static/web/assets/img/user.png" height="50" class="mb-3" alt="Reviewer Image"><h5 class="mb-2">'+response[i].rv_name+'</h5></div><p class="mb-2" style="margin-left: 25px;">'+response[i].rv_review+'</p></div>');
        }
      },
      error: function (request, error) {
        console.error(error);
      },
      complete: function () {},
    });
  }
  getReview();
</script>

<script type="text/javascript">

  $(document).ready(function(){
 
   $("#btn_submit").click(function (e) {
     //verification
     if ($("#txtName1").val().trim().length < 1) {
         alert("Please Enter Name");
         $("#txtName1").focus();
         return false;
     }
 
     if ($("#txtMobileNo1").val().trim().length < 1) {
         alert("Please Enter Mobile number");
         $("#txtMobileNo1").focus();
         return false;
     }

     if ($("#txtMobileNo1").val().trim().length < 10) {
         alert("Please Enter Valid Mobile number");
         $("#txtMobileNo1").focus();
         return false;
     }
 
     if ($("#txtEmail1").val().trim().length < 1) {
         alert("Please Enter Email");
         $("#txtEmail1").focus();
         return false;
     }

     if (!validateEmail($("#txtEmail1").val())) {
         alert("Please Enter Valid Email");
         $("#txtEmail1").focus();
         return false;
     }
 
     if ($("#txtReview1").val().trim().length < 1) {
         alert("Please Enter Review");
         $("#txtReview1").focus();
         return false;
     }
     
     let formData = new FormData();
     formData.append("csrfmiddlewaretoken", $('input[name=csrfmiddlewaretoken]').val());
     formData.append("txtName1", $("#txtName1").val());
     formData.append("txtMobileNo1", $("#txtMobileNo1").val());
     formData.append("txtEmail1", $("#txtEmail1").val());
     formData.append("txtReview1", $("#txtReview1").val());
     formData.append("pgID", $("#pgID").val());
 
     $.ajax({
       beforeSend: function () {
         $("#btn_submit").attr("disabled", true);
       },
       url: "/add_review/",
       type: "POST",
       data: formData,
       processData: false,
       contentType: false,
       success: function (result) {
          alert("Review Successful");
          location.reload();
         
       },
       error: function (request, error) {
         console.error(error);
       },
       complete: function () {
         $("#btn_submit").attr("disabled", false);
       },
     });
   });
 
 });
 
 </script>